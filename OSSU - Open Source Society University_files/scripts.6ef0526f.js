"use strict";angular.module("ossuClientApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","firebase","firebase.ref","firebase.auth","LocalStorageModule","ui.bootstrap","toaster"]),angular.module("ossuClientApp").controller("MainCtrl",["localStorageService","$uibModal",function(a,b){function c(b){return a.get(b)}function d(b,c){a.set(b,c)}var e="7296425a43a9208958f0473cc733489c67e8a88a";c(e)||(b.open({animation:!0,backdrop:"static",controller:"MainmodalcontrollerCtrl",templateUrl:"../partials/homePageModal.html",size:"lg"}),d(e,!0))}]),angular.module("firebase.config",[]).constant("FBURL","https://ossu.firebaseio.com").constant("SIMPLE_LOGIN_PROVIDERS",["github"]).constant("loginRedirectPath","/login"),angular.module("firebase.ref",["firebase","firebase.config"]).factory("Ref",["$window","FBURL",function(a,b){return new a.Firebase(b)}]),function(){angular.module("firebase.auth",["firebase","firebase.ref"]).factory("Auth",["$firebaseAuth","Ref",function(a,b){return a(b)}])}(),angular.module("ossuClientApp").controller("NavbarCtrl",["toaster","$scope","User","$location",function(a,b,c,d){function e(){d.path("/account")}function f(a){b.err=a}b.loginWithGithub=function(){b.err=null,c.githubLogin().then(e,f)},b.logout=function(){c.logout()}}]),angular.module("ossuClientApp").controller("AccountCtrl",["toaster","$timeout","$scope","$uibModal","Auth","User",function(a,b,c,d,e,f){c.courses=null,c.user=f.user,c.edit={},b(function(){f.getUserCourses(c.user.uid).$loaded().then(function(a){c.courses=a})}),c.enableEditMode=function(a){c.edit[a.$id]=!0},c.discard=function(a){c.edit[a.$id]=!1},c.update=function(b){c.courses.$save(b).then(function(){a.pop("success","Course saved"),c.edit[b.$id]=!1})},c.confirmResetProgress=function(){d.open({templateUrl:"/partials/resetProgressModal.html",controller:"ResetProgressModalController"})}}]),angular.module("ossuClientApp").controller("ResetProgressModalController",["$scope","$uibModalInstance","toaster","User",function(a,b,c,d){var e=d.user;a.reset=function(){return d.deleteCourses(e.uid).then(function(){return d.copyCourses(e.uid)}).then(function(){b.dismiss(),c.pop("success","Progress reset")})["catch"](function(a){c.pop("error",a)})},a.dismiss=function(){b.dismiss("cancel")}}]),angular.module("ossuClientApp").directive("ngShowAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("ossuClientApp").directive("ngHideAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("ossuClientApp").config(["$routeProvider","SECURED_ROUTES",function(a,b){a.whenAuthenticated=function(c,d){return d.resolve=d.resolve||{},d.resolve.user=["Auth",function(a){return a.$requireAuth()}],a.when(c,d),b[c]=!0,a}}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/curriculum",{templateUrl:"views/curriculum.html",controller:"CurriculumCtrl"}).whenAuthenticated("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).when("/profile/:userUid",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth","SECURED_ROUTES","loginRedirectPath",function(a,b,c,d,e){function f(a){!a&&g(b.path())&&b.path(e)}function g(a){return d.hasOwnProperty(a)}c.$onAuth(f),a.$on("$routeChangeError",function(a,c,d,f){"AUTH_REQUIRED"===f&&b.path(e)})}]).constant("SECURED_ROUTES",{}),angular.module("ossuClientApp").factory("User",["$log","$timeout","$q","$firebaseObject","$firebaseArray","Ref","Auth","Course",function(a,b,c,d,e,f,g,h){var i={user:{},createProfile:function(a,b){var e=d(f.child("profiles").child(a)),g=h.getCourses();return c.all([e.$loaded(),g.$loaded()]).then(function(g){var h=g[0],i=g[1];h.name?console.log("Profile already exists"):c.all(i.map(function(b){var c=b.$id,e=d(f.child("profiles").child(a).child("courses").child(c));return e.link=b.link,e.title=b.title,e.category=b.category,e.status="Not started",e.repo="",e.$save()})).then(function(){return e.avatar=b.profileImageURL,e.name=b.displayName,e.$save()})})},deleteCourses:function(a){return d(f.child("profiles").child(a).child("courses")).$remove()},copyCourses:function(a){var b=h.getCourses();return b.$loaded().then(function(b){return c.all(b.map(function(b){var c=b.$id,e=d(f.child("profiles").child(a).child("courses").child(c));return e.link=b.link,e.title=b.title,e.category=b.category,e.status="Not started",e.repo="",e.$save()}))})},getUserByUid:function(a){return d(f.child("profiles").child(a))},githubLogin:function(){return g.$authWithOAuthPopup("github",{rememberMe:!0}).then(function(a){return i.createProfile(a.uid,a.github)})},logout:function(){return g.$unauth()},getUserCourses:function(a){return e(f.child("profiles").child(a).child("courses"))}};return g.$onAuth(function(a){a?(angular.copy(a,i.user),i.user.profile=d(f.child("profiles").child(a.uid))):(i.user&&i.user.profile&&i.user.profile.$destroy(),angular.copy({},i.user))}),i}]),angular.module("ossuClientApp").factory("Course",["Ref","$firebaseObject","$firebaseArray",function(a,b,c){var d={},e=a.child("courses"),f=c(e);return d.addCourse=function(a){return f.$add(a)},d.getCourses=function(){return f},d}]),angular.module("ossuClientApp").controller("CurriculumCtrl",["$q","$scope","toaster","CourseCategory","Course",function(a,b,c,d,e){b.courses=null,b.categories=null,b.curriculumLoaded=!1,a.all([d.getCategories().$loaded(),e.getCourses().$loaded()]).then(function(a){b.categories=a[0],b.courses=a[1],b.curriculumLoaded=!0})["catch"](function(a){c.pop("error",a)})}]),angular.module("ossuClientApp").directive("activeMenuPath",["$location",function(a){return{restrict:"A",link:function(b,c,d){var e="active",f=d.activeMenuPath;b.location=a,b.$watch("location.path()",function(a){return a=a.split("/")[1],a===f?c.addClass(e):c.removeClass(e)})}}}]),angular.module("ossuClientApp").controller("ProfileCtrl",["$scope","$routeParams","User",function(a,b,c){var d=b.userUid;a.userCourses=null,a.userProfile=null,c.getUserByUid(d).$loaded().then(function(b){a.userCourses=b.courses,a.userProfile=b})}]),angular.module("ossuClientApp").factory("CourseCategory",["Ref","$firebaseArray",function(a,b){var c=a.child("courseCategories"),d={getCategories:function(){return b(c)}};return d}]),angular.module("ossuClientApp").controller("MainmodalcontrollerCtrl",["$scope","$uibModalInstance",function(a,b){a.ok=function(){b.close()}}]),angular.module("ossuClientApp").controller("AboutCtrl",function(){});